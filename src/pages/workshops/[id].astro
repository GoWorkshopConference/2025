---
import { getCollection, getEntry, render } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import OrganizerCard from "../../components/OrganizerCard.astro";

export async function getStaticPaths() {
  const workshops = await getCollection("workshops");
  return workshops.map((workshop) => ({
    params: { id: workshop.id },
    props: { workshop },
  }));
}

const { workshop } = Astro.props;
const entry = await getEntry("workshops", workshop.id);
if (!entry) {
  throw new Error(`Workshop not found: ${workshop.id}`);
}
const { Content } = await render(entry);

if (entry.data.connpassUrl) {
  return Astro.redirect(entry.data.connpassUrl);
}

---

<Layout title={workshop.data.title}>
  <section class="flex flex-col gap-2 md:gap-4">
    <section>
      <h1 class="text-4xl font-bold mb-8">
        {workshop.data.title}
      </h1>
      <div class="mb-8">
        {
          workshop.data.connpassUrl ? (
            <a
              class="inline-flex items-center justify-center p-0.5 text-sm text-gray-600 font-semibold rounded-lg bg-gradient-to-br from-sky-600 to-fuchsia-700 focus:ring-2 focus:outline-none focus:ring-sky-300 group w-fit"
              href={workshop.data.connpassUrl}
              target="_blank"
              rel="noopener noreferrer"
            >
              <span class="w-full relative px-5 py-2.5 transition-all ease-in duration-75 bg-white rounded-md group-hover:bg-transparent group-hover:text-white flex items-center justify-center gap-2">
                参加登録する
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5l7 7-7 7"
                  />
                </svg>
              </span>
            </a>
          ) : (
            <p class="text-gray-600 px-5 py-2.5 bg-gray-50 rounded-lg border border-gray-200 w-fit cursor-not-allowed">参加登録開始までしばらくお待ちください</p>
          )
        }
      </div>
      <div class="prose w-full max-w-none">
        <Content />
      </div>
    </section>
    <section>
      <h2 class="text-xl font-bold mt-4">オーガナイザー</h2>
      <OrganizerCard
        name={workshop.data.organizer.name}
        avatar={workshop.data.organizer.avatar}
        organization={workshop.data.organizer.organization}
        profile={workshop.data.organizer.profile}
      />
    </section>
  </section>
</Layout>
