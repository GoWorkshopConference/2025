name: Create PR from Google Form

on:
  repository_dispatch:
    types: [form-submission]

jobs:
  create-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Create staff JSON file
        run: |
          # src/data/staffãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®
          mkdir -p src/data/staff
          
          # åŠè§’è‹±æ•°ã®ãŠåå‰ã‚’ãƒ•ã‚¡ã‚¤ãƒ«åã¨ã—ã¦ä½¿ç”¨
          filename="${{ github.event.client_payload.filename }}"
          
          # JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
          cat > src/data/staff/${filename}.json << 'EOF'
          {
            "name": "${{ github.event.client_payload.name }}",
            "image": "${{ github.event.client_payload.image }}",
            "link": "${{ github.event.client_payload.link }}",
            "organization": "${{ github.event.client_payload.organization }}"
          }
          EOF
      
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v7
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "Add new staff member: ${{ github.event.client_payload.name }}"
          title: "Add new staff member: ${{ github.event.client_payload.name }}"
          body: |
            ## æ–°ã—ã„ã‚¹ã‚¿ãƒƒãƒ•ãƒ¡ãƒ³ãƒãƒ¼ã®è¿½åŠ 
            
            **åå‰:** ${{ github.event.client_payload.name }}
            **ãƒ•ã‚¡ã‚¤ãƒ«å:** ${{ github.event.client_payload.filename }}.json
            **æ‰€å±žçµ„ç¹”:** ${{ github.event.client_payload.organization }}
            **SNSãƒªãƒ³ã‚¯:** ${{ github.event.client_payload.link }}
            **ç”»åƒURL:** ${{ github.event.client_payload.image }}
            
            Google Formã‹ã‚‰è‡ªå‹•çš„ã«ä½œæˆã•ã‚ŒãŸPRã§ã™ã€‚
          branch: add-staff-${{ github.event.client_payload.filename }}
          delete-branch: true
      
      - name: Notify Discord
        if: success()
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            ðŸŽ‰ **æ–°ã—ã„ã‚¹ã‚¿ãƒƒãƒ•ã®PRãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼**
            
            **ãƒ¡ãƒ³ãƒãƒ¼:** ${{ github.event.client_payload.name }}
            **æ‰€å±ž:** ${{ github.event.client_payload.organization }}
            
            PRã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ãã ã•ã„ï¼šhttps://github.com/GoWorkshopConference/2025/pulls